<!-- Navbar del Jefe de Curso -->
<nav class="navbar">
  <div class="navbar-brand">
    <i class="fas fa-graduation-cap"></i>
    <span>AcTitUBB</span>
  </div>
  
  <div class="navbar-actions">
    <!-- Notificaciones -->
    <div class="action-item notifications-menu" (click)="togglePanelNotificaciones()">
        <i class="fas fa-bell"></i>
        <span *ngIf="notificacionesNoLeidas > 0" class="notification-badge">{{ notificacionesNoLeidas }}</span>
      
      <!-- Panel desplegable de notificaciones -->
      <div *ngIf="mostrarPanelNotificaciones" class="dropdown-menu notifications-dropdown show">
        <div class="panel-header">
          <h3>Notificaciones</h3>
          <button class="btn-small" (click)="marcarTodasComoLeidas(); $event.stopPropagation()" *ngIf="notificacionesNoLeidas > 0">
            Marcar todas como leídas
          </button>
        </div>
        
        <div class="notifications-list" *ngIf="notificaciones.length > 0">
          <div *ngFor="let notificacion of notificaciones" 
               class="notification-item" 
               [class.no-leida]="!notificacion.leida"
               (click)="marcarComoLeida(notificacion); $event.stopPropagation()">
            <div class="notification-icon" [style.color]="obtenerColorNotificacion(notificacion.tipo)">
              <i [class]="obtenerIconoNotificacion(notificacion.tipo)"></i>
            </div>
            <div class="notification-content">
              <h4>{{ notificacion.titulo }}</h4>
              <p>{{ notificacion.mensaje }}</p>
              <span class="notification-time">{{ formatearTiempoNotificacion(notificacion.fecha) }}</span>
            </div>
            <button class="notification-close" (click)="eliminarNotificacion(notificacion.id); $event.stopPropagation()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        
        <div *ngIf="notificaciones.length === 0" class="no-notifications">
          <i class="fas fa-bell-slash"></i>
          <p>No hay notificaciones</p>
        </div>
      </div>
    </div>

    <!-- Menú de usuario -->
    <div class="action-item user-menu" (click)="toggleUserMenu()">
      <i class="fas fa-user-circle"></i>
      <span>{{ userName || 'Jefe de Curso' }}</span>
      <i class="fas fa-chevron-down"></i>
      
      <div class="dropdown-menu" [class.show]="showUserMenu">
        <div class="dropdown-item" (click)="cerrarSesion()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Cerrar Sesión</span>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Contenido principal -->
<div class="main-container">
  <!-- Header con bienvenida -->
  <div class="welcome-header">
    <div class="welcome-content">
      <h1>Panel Jefe de Curso</h1>
      <p>Gestión completa del sistema de propuestas de título</p>
    </div>
    <div class="welcome-icon">
      <i class="fas fa-user-tie"></i>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loadingDashboard" class="loading-state">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
    </div>
    <p>Cargando estadísticas del sistema...</p>
  </div>

  <!-- Dashboard de Estadísticas Unificado -->
  @if (dashboard && !loadingDashboard) {
    <div class="analytics-section">
      <div class="section-title">
      <i class="fas fa-chart-bar"></i>
        <h2>Estadísticas del Sistema</h2>
      </div>
    
      <!-- Métricas Principales de Propuestas -->
      <div class="stats-grid-propuestas">
      <!-- Total de Propuestas -->
      <div class="stat-card primary">
        <div class="stat-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="stat-content">
            <h3>{{ dashboard.metricas_generales?.total_propuestas || 0 }}</h3>
          <p>Total de Propuestas</p>
        </div>
      </div>

      <!-- Propuestas Pendientes -->
      <div class="stat-card warning">
        <div class="stat-icon">
          <i class="fas fa-clock"></i>
        </div>
        <div class="stat-content">
            <h3>{{ dashboard.metricas_generales?.propuestas_pendientes || 0 }}</h3>
          <p>Pendientes</p>
        </div>
      </div>

      <!-- Propuestas en Revisión -->
      <div class="stat-card info">
        <div class="stat-icon">
          <i class="fas fa-search"></i>
        </div>
        <div class="stat-content">
            <h3>{{ dashboard.metricas_generales?.propuestas_en_revision || 0 }}</h3>
          <p>En Revisión</p>
        </div>
      </div>

      <!-- Propuestas Aprobadas -->
      <div class="stat-card success">
        <div class="stat-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-content">
            <h3>{{ dashboard.metricas_generales?.propuestas_aprobadas || 0 }}</h3>
          <p>Aprobadas</p>
        </div>
      </div>
      </div>

      <!-- Métricas Generales -->
      <div class="metricas-generales">
        <div class="subsection-title">
          <i class="fas fa-tachometer-alt"></i>
          <h3>Métricas Generales</h3>
        </div>
        
        <div class="metricas-grid">
          <div class="metrica-card estudiantes">
            <div class="metrica-icon">
              <i class="fas fa-user-graduate"></i>
            </div>
            <div class="metrica-content">
              <h4>{{ dashboard.metricas_generales?.total_estudiantes || 0 }}</h4>
              <p>Estudiantes</p>
            </div>
          </div>
          
          <div class="metrica-card profesores">
            <div class="metrica-icon">
              <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <div class="metrica-content">
              <h4>{{ dashboard.metricas_generales?.total_profesores || 0 }}</h4>
              <p>Profesores</p>
            </div>
          </div>
          
          <div class="metrica-card proyectos">
            <div class="metrica-icon">
              <i class="fas fa-folder-open"></i>
            </div>
            <div class="metrica-content">
              <h4>{{ dashboard.metricas_generales?.total_proyectos_activos || 0 }}</h4>
              <p>Proyectos Activos</p>
            </div>
          </div>
          
          <div class="metrica-card rechazadas">
            <div class="metrica-icon">
              <i class="fas fa-times-circle"></i>
            </div>
            <div class="metrica-content">
              <h4>{{ dashboard.metricas_generales?.propuestas_rechazadas || 0 }}</h4>
              <p>Propuestas Rechazadas</p>
            </div>
          </div>
          
          <div class="metrica-card avance">
            <div class="metrica-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="metrica-content">
              <h4>{{ dashboard.metricas_generales?.avance_promedio_proyectos || 0 }}%</h4>
              <p>Avance Promedio</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Propuestas y Proyectos por Estado -->
      <div class="estados-section">
        <div class="subsection-title">
          <i class="fas fa-list-alt"></i>
          <h3>Distribución por Estados</h3>
        </div>
        
        <div class="estados-grid">
          <!-- Propuestas por Estado -->
          <div class="estados-card">
            <h4>
              <i class="fas fa-file-alt"></i>
              Propuestas por Estado
            </h4>
            <div class="estados-list">
              @for (estado of dashboard.propuestas_por_estado; track estado.estado) {
                <div class="estado-item">
                  <div class="estado-bar">
                    <div class="estado-label">
                      <span class="estado-nombre">{{ estado.estado }}</span>
                      <span class="estado-count">{{ estado.total }}</span>
                    </div>
                    <div class="bar-container">
                      <div class="bar-fill" 
                           [style.width.%]="(estado.total / dashboard.metricas_generales.total_estudiantes * 100)"
                           [class]="'estado-' + estado.estado"></div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
          
          <!-- Proyectos por Estado -->
          <div class="estados-card">
            <h4>
              <i class="fas fa-project-diagram"></i>
              Proyectos por Estado
            </h4>
            <div class="estados-list">
              @for (estado of dashboard.proyectos_por_estado; track estado.estado_proyecto) {
                <div class="estado-item">
                  <div class="estado-bar">
                    <div class="estado-label">
                      <span class="estado-nombre">{{ estado.estado_proyecto }}</span>
                      <span class="estado-count">{{ estado.total }}</span>
                    </div>
                    <div class="bar-container">
                      <div class="bar-fill" 
                           [style.width.%]="(estado.total / dashboard.metricas_generales.total_proyectos_activos * 100)"
                           [class]="'estado-' + estado.estado_proyecto"></div>
                    </div>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Distribución por Modalidad -->
      @if (dashboard.distribucion_modalidad && dashboard.distribucion_modalidad.length > 0) {
        <div class="modalidad-section">
          <div class="subsection-title">
            <i class="fas fa-layer-group"></i>
            <h3>Distribución por Modalidad de Proyecto</h3>
          </div>
          
          <div class="modalidad-grid">
            @for (modalidad of dashboard.distribucion_modalidad; track modalidad.modalidad) {
              <div class="modalidad-card">
                <div class="modalidad-header">
                  <div class="modalidad-icon">
                    @if (modalidad.modalidad === 'proyecto_investigacion') {
                      <i class="fas fa-flask"></i>
                    } @else if (modalidad.modalidad === 'tesis') {
                      <i class="fas fa-graduation-cap"></i>
                    } @else if (modalidad.modalidad === 'proyecto_profesional') {
                      <i class="fas fa-briefcase"></i>
                    } @else {
                      <i class="fas fa-file"></i>
                    }
                  </div>
                  <h4>{{ modalidad.modalidad }}</h4>
                </div>
                <div class="modalidad-stats">
                  <div class="stat-row">
                    <span class="stat-label">Total:</span>
                    <span class="stat-value">{{ modalidad.total }}</span>
                  </div>
                  <div class="stat-row">
                    <span class="stat-label">Avance:</span>
                    <span class="stat-value">{{ modalidad.avance_promedio || 0 }}%</span>
                  </div>
                </div>
                <div class="modalidad-progress">
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width.%]="modalidad.avance_promedio || 0"></div>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- Tiempos de Revisión de Propuestas -->
      @if (dashboard.tiempos_revision_propuestas && dashboard.tiempos_revision_propuestas.length > 0) {
        <div class="tiempos-revision-section">
          <div class="subsection-title">
            <i class="fas fa-clock"></i>
            <h3>Tiempos Promedio de Revisión (Últimos 6 Meses)</h3>
          </div>
          
          <div class="tiempos-table-wrapper">
            <table class="tiempos-table">
              <thead>
                <tr>
                  <th>Mes</th>
                  <th>Propuestas Revisadas</th>
                  <th>Tiempo Promedio (días)</th>
                  <th>Estado</th>
                </tr>
              </thead>
              <tbody>
                @for (tiempo of dashboard.tiempos_revision_propuestas; track tiempo.mes) {
                  <tr>
                    <td class="mes-col">
                      <i class="fas fa-calendar"></i>
                      {{ tiempo.mes }}
                    </td>
                    <td class="cantidad-col">{{ tiempo.propuestas_revisadas }}</td>
                    <td class="tiempo-col">
                      <span class="tiempo-badge" 
                            [class.rapido]="tiempo.promedio_dias_revision <= 5"
                            [class.normal]="tiempo.promedio_dias_revision > 5 && tiempo.promedio_dias_revision <= 10"
                            [class.lento]="tiempo.promedio_dias_revision > 10">
                        {{ tiempo.promedio_dias_revision }} días
                      </span>
                    </td>
                    <td class="estado-col">
                      @if (tiempo.promedio_dias_revision <= 5) {
                        <span class="estado-badge excelente">
                          <i class="fas fa-bolt"></i>
                          Excelente
                        </span>
                      } @else if (tiempo.promedio_dias_revision <= 10) {
                        <span class="estado-badge bueno">
                          <i class="fas fa-check"></i>
                          Bueno
                        </span>
                      } @else {
                        <span class="estado-badge mejorable">
                          <i class="fas fa-exclamation-triangle"></i>
                          Mejorable
                        </span>
                      }
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      }

      <!-- Tendencias Mensuales -->
      @if (dashboard.tendencias_mensuales && dashboard.tendencias_mensuales.length > 0) {
        <div class="tendencias-section">
          <div class="subsection-title">
            <i class="fas fa-chart-area"></i>
            <h3>Tendencias de Actividad (Últimos 6 Meses)</h3>
          </div>
          
          <div class="tendencias-chart">
            @for (mes of dashboard.tendencias_mensuales; track mes.mes) {
              <div class="chart-bar-group">
                <div class="chart-bars">
                  <div class="chart-bar propuestas-bar" 
                       [style.height.%]="(mes.propuestas_creadas / 10 * 100)"
                       [title]="mes.propuestas_creadas + ' propuestas'">
                    <span class="bar-value">{{ mes.propuestas_creadas }}</span>
                  </div>
                  <div class="chart-bar proyectos-bar" 
                       [style.height.%]="(mes.proyectos_creados / 10 * 100)"
                       [title]="mes.proyectos_creados + ' proyectos'">
                    <span class="bar-value">{{ mes.proyectos_creados }}</span>
                  </div>
                </div>
                <div class="chart-label">{{ mes.mes }}</div>
              </div>
            }
          </div>
          <div class="chart-legend">
            <div class="legend-item">
              <div class="legend-color propuestas"></div>
              <span>Propuestas Creadas</span>
            </div>
            <div class="legend-item">
              <div class="legend-color proyectos"></div>
              <span>Proyectos Creados</span>
            </div>
          </div>
        </div>
      }

      <!-- Carga de Profesores (Top 10) -->
      @if (dashboard.carga_profesores && dashboard.carga_profesores.length > 0) {
        <div class="carga-profesores-section">
          <div class="subsection-title">
            <i class="fas fa-users-cog"></i>
            <h3>Carga de Profesores (Top 10)</h3>
          </div>
          
          <div class="profesores-list">
            @for (profesor of dashboard.carga_profesores; track profesor.rut; let i = $index) {
              <div class="profesor-item" [class.top3]="i < 3">
                <div class="profesor-rank">
                  @if (i === 0) {
                    <i class="fas fa-trophy" style="color: #FFD700;"></i>
                  } @else if (i === 1) {
                    <i class="fas fa-trophy" style="color: #C0C0C0;"></i>
                  } @else if (i === 2) {
                    <i class="fas fa-trophy" style="color: #CD7F32;"></i>
                  } @else {
                    <span class="rank-number">{{ i + 1 }}</span>
                  }
                </div>
                <div class="profesor-info">
                  <h4>{{ profesor.nombre }}</h4>
                  <p class="profesor-email">{{ profesor.correo }}</p>
                </div>
                <div class="profesor-stats">
                  <div class="stat-pill">
                    <i class="fas fa-graduation-cap"></i>
                    {{ profesor.proyectos_guia }} Guía
                  </div>
                  <div class="stat-pill">
                    <i class="fas fa-user-check"></i>
                    {{ profesor.proyectos_informante }} Informante
                  </div>
                  <div class="stat-pill total">
                    <i class="fas fa-folder"></i>
                    {{ profesor.total_proyectos }} Total
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }

  <!-- Secciones de gestión -->
  <div class="admin-sections">
    <h2 class="section-title">
      <i class="fas fa-tools"></i>
      Herramientas de Gestión
    </h2>
    
    <div class="sections-grid">
      <!-- Gestión de Propuestas -->
      <div class="section-card" (click)="irAGestionPropuestas()">
        <div class="card-icon">
          <i class="fas fa-file-alt"></i>
        </div>
        <div class="card-content">
          <h3>Gestión de Propuestas</h3>
          <p>Ver, editar y gestionar todas las propuestas del sistema</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>

      <!-- Gestión de Proyectos -->
      <div class="section-card" (click)="irAGestionProyectos()">
        <div class="card-icon">
          <i class="fas fa-rocket"></i>
        </div>
        <div class="card-content">
          <h3>Gestión de Proyectos</h3>
          <p>Ver, gestionar y monitorear todos los proyectos activos</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>

      <!-- Gestión de Usuarios -->
      <div class="section-card" (click)="irAGestionUsuarios()">
        <div class="card-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="card-content">
          <h3>Gestión de Usuarios</h3>
          <p>Gestionar estudiantes, profesores y roles del sistema</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>


      <!-- Asignaciones -->
      <div class="section-card" (click)="irAAsignaciones()">
        <div class="card-icon">
          <i class="fas fa-user-plus"></i>
        </div>
        <div class="card-content">
          <h3>Asignaciones</h3>
          <p>Asignar profesores a propuestas y gestionar responsabilidades</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>

      <!-- Sistema de Calendario Unificado -->
      <div class="section-card calendar-unified-card" (click)="irACalendarioUnificado()">
        <div class="card-icon">
          <i class="fas fa-calendar"></i>
        </div>
        <div class="card-content">
          <h3>Sistema de Calendario</h3>
          <p>Gestión completa: fechas globales, propuestas, proyectos y reuniones</p>
          <div class="card-badges">
            <span class="badge"><i class="fas fa-calendar-alt"></i> Eventos</span>
            <span class="badge"><i class="fas fa-calendar-check"></i> Propuestas</span>
            <span class="badge"><i class="fas fa-calendar-day"></i> Proyectos</span>
            <span class="badge"><i class="fas fa-handshake"></i> Reuniones</span>
          </div>
          <div class="card-actions">
            <span class="action-text">Acceder al Sistema</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>

      <!-- Gestión de Entidades Externas -->
      <div class="section-card" (click)="irAEntidadesExternas()">
        <div class="card-icon">
          <i class="fas fa-building"></i>
        </div>
        <div class="card-content">
          <h3>Entidades Externas</h3>
          <p>Gestionar empresas, ONGs y organizaciones que colaboran</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>

      <!-- Gestión de Colaboradores Externos -->
      <div class="section-card" (click)="irAColaboradoresExternos()">
        <div class="card-icon">
          <i class="fas fa-user-tie"></i>
        </div>
        <div class="card-content">
          <h3>Colaboradores Externos</h3>
          <p>Gestionar supervisores, mentores y asesores técnicos externos</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Actividades Académicas (Como Profesor) -->
    <div class="section-divider"></div>
    
    <h2 class="section-title">
      <i class="fas fa-chalkboard-teacher"></i>
      Mis Actividades como Profesor
    </h2>
    
    <div class="sections-grid">
      <!-- Propuestas Asignadas -->
      <div class="section-card profesor-card" (click)="irAPropuestasAsignadas()">
        <div class="card-icon">
          <i class="fas fa-file-signature"></i>
        </div>
        <div class="card-content">
          <h3>Propuestas Asignadas</h3>
          <p>Revisar y evaluar propuestas de título asignadas</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>

      <!-- Mis Proyectos (Cronogramas) -->
      <div class="section-card profesor-card" (click)="irAMisProyectos()">
        <div class="card-icon">
          <i class="fas fa-tasks"></i>
        </div>
        <div class="card-content">
          <h3>Proyectos que Guío</h3>
          <p>Gestionar cronogramas y seguimiento de proyectos</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>

      <!-- Reuniones -->
      <div class="section-card profesor-card" (click)="irAReuniones()">
        <div class="card-icon">
          <i class="fas fa-calendar-check"></i>
        </div>
        <div class="card-content">
          <h3>Reuniones</h3>
          <p>Gestionar disponibilidad y reuniones con estudiantes</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>

      <!-- Reportes -->
      <div class="section-card profesor-card" (click)="irAReportes()">
        <div class="card-icon">
          <i class="fas fa-chart-bar"></i>
        </div>
        <div class="card-content">
          <h3>Reportes Académicos</h3>
          <p>Ver métricas y estadísticas de mis actividades</p>
          <div class="card-actions">
            <span class="action-text">Acceder</span>
            <i class="fas fa-arrow-right"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Sección de Monitoreo Regulatorio -->
    <div class="analytics-section">
      <div class="section-title">
        <i class="fas fa-exclamation-triangle"></i>
        <h2>Monitoreo Regulatorio</h2>
      </div>

      <div class="regulatory-grid">
        <!-- Proyectos en Riesgo de Abandono -->
        <div class="regulatory-card risk-card">
          <div class="card-header">
            <i class="fas fa-exclamation-circle"></i>
            <h3>Proyectos en Riesgo</h3>
          </div>
          <div class="card-body">
            <div class="regulatory-stats">
              <div class="stat-large">
                <span class="number">{{ proyectosRiesgo.length || 0 }}</span>
                <span class="label">Proyectos monitoreados</span>
              </div>
            </div>
            <div class="risk-levels" *ngIf="proyectosRiesgo && proyectosRiesgo.length > 0">
              <div class="risk-item critico">
                <i class="fas fa-circle"></i>
                <span>{{ contarPorRiesgo('abandono_potencial') }} Abandono potencial</span>
              </div>
              <div class="risk-item alto">
                <i class="fas fa-circle"></i>
                <span>{{ contarPorRiesgo('en_riesgo') }} En riesgo</span>
              </div>
              <div class="risk-item medio">
                <i class="fas fa-circle"></i>
                <span>{{ contarPorRiesgo('alerta_previa') }} Alerta previa</span>
              </div>
            </div>
            <button class="btn-secondary" (click)="verProyectosRiesgo()">
              <i class="fas fa-list"></i> Ver detalles
            </button>
          </div>
        </div>

        <!-- Informantes Pendientes -->
        <div class="regulatory-card informante-card">
          <div class="card-header">
            <i class="fas fa-clock"></i>
            <h3>Entregas Pendientes (Informante)</h3>
          </div>
          <div class="card-body">
            <div class="regulatory-stats">
              <div class="stat-large">
                <span class="number">{{ informantesPendientes.length || 0 }}</span>
                <span class="label">Revisiones pendientes</span>
              </div>
            </div>
            <div class="deadline-levels" *ngIf="informantesPendientes && informantesPendientes.length > 0">
              <div class="deadline-item vencido">
                <i class="fas fa-ban"></i>
                <span>{{ contarPorPlazo('vencido') }} Vencidas</span>
              </div>
              <div class="deadline-item urgente">
                <i class="fas fa-exclamation"></i>
                <span>{{ contarPorPlazo('urgente') }} Urgentes (≤3 días)</span>
              </div>
              <div class="deadline-item proximo">
                <i class="fas fa-hourglass-half"></i>
                <span>{{ contarPorPlazo('proximo') }} Próximas (≤7 días)</span>
              </div>
            </div>
            <button class="btn-secondary" (click)="verInformantesPendientes()">
              <i class="fas fa-list"></i> Ver detalles
            </button>
          </div>
        </div>

        <!-- Alertas Activas -->
        <div class="regulatory-card alerts-card">
          <div class="card-header">
            <i class="fas fa-bell"></i>
            <h3>Alertas de Abandono</h3>
          </div>
          <div class="card-body">
            <div class="regulatory-stats">
              <div class="stat-large">
                <span class="number">{{ alertasAbandono.length || 0 }}</span>
                <span class="label">Alertas activas</span>
              </div>
            </div>
            <div class="alert-severity" *ngIf="alertasAbandono && alertasAbandono.length > 0">
              <div class="severity-item critico">
                <span class="dot"></span>
                <span>{{ contarPorSeveridad('critico') }} Críticas</span>
              </div>
              <div class="severity-item grave">
                <span class="dot"></span>
                <span>{{ contarPorSeveridad('grave') }} Graves</span>
              </div>
              <div class="severity-item moderado">
                <span class="dot"></span>
                <span>{{ contarPorSeveridad('moderado') }} Moderadas</span>
              </div>
            </div>
            <button class="btn-secondary" (click)="verAlertasAbandono()">
              <i class="fas fa-list"></i> Gestionar alertas
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Proyectos en Riesgo -->
<div class="modal-overlay" *ngIf="mostrarModalProyectosRiesgo" (click)="cerrarModalProyectosRiesgo()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2><i class="fas fa-exclamation-triangle"></i> Proyectos en Riesgo de Abandono</h2>
      <button class="close-btn" (click)="cerrarModalProyectosRiesgo()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div *ngIf="proyectosRiesgo.length === 0" class="empty-state">
        <i class="fas fa-check-circle"></i>
        <p>No hay proyectos en riesgo de abandono en este momento.</p>
      </div>
      <div *ngIf="proyectosRiesgo.length > 0" class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Proyecto</th>
              <th>Estudiante</th>
              <th>Días sin Actividad</th>
              <th>Nivel de Riesgo</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let proyecto of proyectosRiesgo; trackBy: trackByProyectoId">
              <td>
                <strong>{{ proyecto.titulo }}</strong>
              </td>
              <td>{{ proyecto.estudiante_nombre }}</td>
              <td>
                <span class="badge badge-warning">
                  {{ proyecto.dias_sin_actividad }} días
                </span>
              </td>
              <td>
                <span class="badge" 
                      [ngClass]="{
                        'badge-danger': proyecto.nivel_riesgo === 'abandono_potencial',
                        'badge-warning': proyecto.nivel_riesgo === 'en_riesgo',
                        'badge-info': proyecto.nivel_riesgo === 'alerta_previa'
                      }">
                  {{ proyecto.nivel_riesgo }}
                </span>
              </td>
              <td>{{ proyecto.estado_nombre }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="cerrarModalProyectosRiesgo()">
        Cerrar
      </button>
    </div>
  </div>
</div>

<!-- Modal: Informantes Pendientes -->
<div class="modal-overlay" *ngIf="mostrarModalInformantesPendientes" (click)="cerrarModalInformantesPendientes()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2><i class="fas fa-clock"></i> Entregas Pendientes de Revisión</h2>
      <button class="close-btn" (click)="cerrarModalInformantesPendientes()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div *ngIf="informantesPendientes.length === 0" class="empty-state">
        <i class="fas fa-check-circle"></i>
        <p>No hay entregas pendientes de revisión por informantes.</p>
      </div>
      <div *ngIf="informantesPendientes.length > 0" class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Proyecto</th>
              <th>Estudiante</th>
              <th>Informante</th>
              <th>Días Restantes</th>
              <th>Estado del Plazo</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of informantesPendientes; trackBy: trackByHitoId">
              <td>
                <strong>{{ item.proyecto_titulo }}</strong>
              </td>
              <td>{{ item.estudiante_nombre }}</td>
              <td>{{ item.informante_nombre || 'No asignado' }}</td>
              <td>
                <span class="badge"
                      [ngClass]="{
                        'badge-danger': item.estado_plazo === 'vencido',
                        'badge-warning': item.estado_plazo === 'urgente',
                        'badge-info': item.estado_plazo === 'proximo',
                        'badge-success': item.estado_plazo === 'en_plazo'
                      }">
                  {{ item.dias_restantes }} días
                </span>
              </td>
              <td>
                <span class="badge"
                      [ngClass]="{
                        'badge-danger': item.estado_plazo === 'vencido',
                        'badge-warning': item.estado_plazo === 'urgente',
                        'badge-info': item.estado_plazo === 'proximo',
                        'badge-success': item.estado_plazo === 'en_plazo'
                      }">
                  {{ item.estado_plazo }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="cerrarModalInformantesPendientes()">
        Cerrar
      </button>
    </div>
  </div>
</div>

<!-- Modal: Alertas de Abandono -->
<div class="modal-overlay" *ngIf="mostrarModalAlertasAbandono" (click)="cerrarModalAlertasAbandono()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2><i class="fas fa-bell"></i> Alertas de Abandono de Proyectos</h2>
      <button class="close-btn" (click)="cerrarModalAlertasAbandono()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div *ngIf="alertasAbandono.length === 0" class="empty-state">
        <i class="fas fa-check-circle"></i>
        <p>No hay alertas de abandono activas en este momento.</p>
      </div>
      <div *ngIf="alertasAbandono.length > 0" class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Proyecto</th>
              <th>Tipo de Alerta</th>
              <th>Días sin Actividad</th>
              <th>Nivel de Severidad</th>
              <th>Fecha de Alerta</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let alerta of alertasAbandono; trackBy: trackByAlertaId">
              <td>
                <strong>{{ alerta.proyecto_titulo }}</strong>
                <div style="font-size: 0.85rem; color: #6c757d;">
                  {{ alerta.estudiante_nombre }}
                </div>
              </td>
              <td>{{ alerta.tipo_alerta }}</td>
              <td>
                <span class="badge badge-warning">
                  {{ alerta.dias_sin_actividad }} días
                </span>
              </td>
              <td>
                <span class="badge" 
                      [ngClass]="{
                        'badge-danger': alerta.nivel_severidad === 'critico',
                        'badge-warning': alerta.nivel_severidad === 'grave',
                        'badge-info': alerta.nivel_severidad === 'moderado',
                        'badge-success': alerta.nivel_severidad === 'leve'
                      }">
                  {{ alerta.nivel_severidad }}
                </span>
              </td>
              <td>{{ alerta.fecha_alerta | date:'dd/MM/yyyy HH:mm' }}</td>
              <td>
                <span class="badge" 
                      [ngClass]="{
                        'badge-success': alerta.alerta_atendida,
                        'badge-warning': !alerta.alerta_atendida
                      }">
                  {{ alerta.alerta_atendida ? 'Atendida' : 'Pendiente' }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" (click)="cerrarModalAlertasAbandono()">
        Cerrar
      </button>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="main-footer">
  <div class="footer-content">
    <p>&copy; {{fechaActual() | date:'yyyy'}} Universidad del Bío-Bío - Panel Jefe de Curso</p>
  </div>
</footer> 