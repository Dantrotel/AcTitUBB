<div class="page-container">
  <nav class="navbar">
    <button class="btn-back" (click)="volver()">
      <i class="fas fa-arrow-left"></i>
      Volver
    </button>
    <h1>
      <i class="fas fa-calendar-check"></i>
      Gesti√≥n del Per√≠odo de Propuestas
    </h1>
  </nav>

  <div class="page-content">
    <!-- Alerts -->
    <div class="alert alert-error" *ngIf="error">
      <i class="fas fa-exclamation-circle"></i>
      <span>{{ error }}</span>
    </div>

    <div class="alert alert-success" *ngIf="mensaje">
      <i class="fas fa-check-circle"></i>
      <span>{{ mensaje }}</span>
    </div>

    <!-- Loading -->
    <div class="loading-state" *ngIf="loading && !estadoPeriodo">
      <div class="spinner"></div>
      <p>Cargando informaci√≥n del per√≠odo...</p>
    </div>

    <!-- Sin Per√≠odo Configurado -->
    <div class="empty-state" *ngIf="!loading && estadoPeriodo && !estadoPeriodo.existe">
      <i class="fas fa-calendar-times"></i>
      <h2>No hay per√≠odo de propuestas configurado</h2>
      <p>Debes crear una fecha l√≠mite para entrega de propuestas desde el calendario.</p>
      <button class="btn btn-primary" (click)="irACalendario()">
        <i class="fas fa-calendar-plus"></i>
        Ir al Calendario
      </button>
    </div>

    <!-- Estado del Per√≠odo -->
    <div class="content-grid" *ngIf="!loading && estadoPeriodo && estadoPeriodo.existe">
      
      <!-- Tarjeta de Estado -->
      <div class="estado-card" [ngClass]="getEstadoClass()">
        <div class="estado-header">
          <div class="estado-icon">
            <i [class]="estadoPeriodo.habilitada ? 'fas fa-lock-open' : 'fas fa-lock'"></i>
          </div>
          <div class="estado-info">
            <h2>{{ estadoPeriodo.titulo }}</h2>
            <p class="descripcion" *ngIf="estadoPeriodo.descripcion">
              {{ estadoPeriodo.descripcion }}
            </p>
          </div>
          <div class="estado-badge">
            <span [ngClass]="getEstadoClass()">
              {{ getEstadoLabel() }}
            </span>
          </div>
        </div>

        <div class="estado-body">
          <div class="info-grid">
            <div class="info-item">
              <i class="fas fa-calendar-day"></i>
              <div>
                <label>Fecha L√≠mite:</label>
                <span class="valor">{{ formatearFecha(estadoPeriodo.fecha_limite) }}</span>
              </div>
            </div>

            <div class="info-item">
              <i class="fas fa-hourglass-half"></i>
              <div>
                <label>Tiempo Restante:</label>
                <span class="valor" [ngClass]="{
                  'urgente': estadoPeriodo.dias_restantes !== undefined && estadoPeriodo.dias_restantes <= 3,
                  'vencido': estadoPeriodo.dias_restantes !== undefined && estadoPeriodo.dias_restantes < 0
                }">
                  {{ getDiasRestantesTexto() }}
                </span>
              </div>
            </div>

            <div class="info-item">
              <i [class]="estadoPeriodo.habilitada ? 'fas fa-check-circle' : 'fas fa-times-circle'"></i>
              <div>
                <label>Estado del Per√≠odo:</label>
                <span class="valor" [class.activo]="estadoPeriodo.habilitada" [class.inactivo]="!estadoPeriodo.habilitada">
                  {{ estadoPeriodo.habilitada ? 'HABILITADO' : 'DESHABILITADO' }}
                </span>
              </div>
            </div>

            <div class="info-item">
              <i [class]="estadoPeriodo.puede_recibir_propuestas ? 'fas fa-upload' : 'fas fa-ban'"></i>
              <div>
                <label>Acepta Propuestas:</label>
                <span class="valor" [class.activo]="estadoPeriodo.puede_recibir_propuestas" [class.inactivo]="!estadoPeriodo.puede_recibir_propuestas">
                  {{ estadoPeriodo.puede_recibir_propuestas ? 'S√ç' : 'NO' }}
                </span>
              </div>
            </div>

            <div class="info-item">
              <i [class]="estadoPeriodo.permite_extension ? 'fas fa-clock' : 'fas fa-hourglass-end'"></i>
              <div>
                <label>Permite Extensiones:</label>
                <span class="valor">
                  {{ estadoPeriodo.permite_extension ? 'S√≠' : 'No' }}
                </span>
              </div>
            </div>
          </div>

          <!-- Mensaje Informativo -->
          <div class="info-box" [ngClass]="{
            'info-success': estadoPeriodo.habilitada && estadoPeriodo.puede_recibir_propuestas,
            'info-warning': estadoPeriodo.habilitada && estadoPeriodo.dias_restantes !== undefined && estadoPeriodo.dias_restantes <= 3,
            'info-danger': !estadoPeriodo.habilitada || (estadoPeriodo.dias_restantes !== undefined && estadoPeriodo.dias_restantes < 0)
          }">
            <i [class]="estadoPeriodo.puede_recibir_propuestas ? 'fas fa-info-circle' : 'fas fa-exclamation-triangle'"></i>
            <div>
              <strong>{{ estadoPeriodo.puede_recibir_propuestas ? 'Sistema Activo' : 'Sistema Inactivo' }}</strong>
              <p *ngIf="estadoPeriodo.puede_recibir_propuestas">
                Los estudiantes pueden crear y enviar propuestas hasta el {{ formatearFecha(estadoPeriodo.fecha_limite) }}.
              </p>
              <p *ngIf="!estadoPeriodo.habilitada">
                El per√≠odo est√° cerrado manualmente. Los estudiantes NO pueden crear propuestas.
              </p>
              <p *ngIf="estadoPeriodo.habilitada && estadoPeriodo.dias_restantes !== undefined && estadoPeriodo.dias_restantes < 0">
                El per√≠odo ha vencido. Los estudiantes NO pueden crear propuestas. Puedes deshabilitarlo autom√°ticamente.
              </p>
            </div>
          </div>
        </div>

        <!-- Acciones -->
        <div class="estado-actions">
          <button 
            class="btn btn-success"
            *ngIf="!estadoPeriodo.habilitada"
            (click)="habilitarPeriodo()"
            [disabled]="loading">
            <i [class]="loading ? 'fas fa-spinner fa-spin' : 'fas fa-lock-open'"></i>
            {{ loading ? 'Habilitando...' : 'Habilitar Per√≠odo' }}
          </button>

          <button 
            class="btn btn-danger"
            *ngIf="estadoPeriodo.habilitada"
            (click)="deshabilitarPeriodo()"
            [disabled]="loading">
            <i [class]="loading ? 'fas fa-spinner fa-spin' : 'fas fa-lock'"></i>
            {{ loading ? 'Deshabilitando...' : 'Deshabilitar Per√≠odo' }}
          </button>

          <button 
            class="btn btn-warning"
            (click)="deshabilitarVencidos()"
            [disabled]="loading">
            <i class="fas fa-broom"></i>
            Deshabilitar Per√≠odos Vencidos
          </button>

          <button 
            class="btn btn-secondary"
            (click)="irACalendario()">
            <i class="fas fa-calendar-alt"></i>
            Ver Calendario Completo
          </button>
        </div>
      </div>

      <!-- Instrucciones -->
      <div class="instrucciones-card">
        <h3>
          <i class="fas fa-question-circle"></i>
          ¬øC√≥mo funciona?
        </h3>
        <ul>
          <li>
            <strong>Habilitar Per√≠odo:</strong> Permite que los estudiantes creen y env√≠en propuestas.
          </li>
          <li>
            <strong>Deshabilitar Per√≠odo:</strong> Bloquea la creaci√≥n de nuevas propuestas inmediatamente.
          </li>
          <li>
            <strong>Deshabilitaci√≥n Autom√°tica:</strong> El sistema deshabilita autom√°ticamente los per√≠odos al alcanzar la fecha l√≠mite.
          </li>
          <li>
            <strong>Gesti√≥n Manual:</strong> Puedes habilitar/deshabilitar el per√≠odo en cualquier momento, independientemente de la fecha.
          </li>
          <li>
            <strong>Crear Nuevo Per√≠odo:</strong> Debes crear una nueva fecha en el calendario con tipo "Entrega de Propuesta" y marcarla como global.
          </li>
        </ul>

        <div class="tips-box">
          <h4>
            <i class="fas fa-lightbulb"></i>
            Recomendaciones
          </h4>
          <p>‚úÖ Habilita el per√≠odo con anticipaci√≥n para que los estudiantes tengan tiempo suficiente.</p>
          <p>‚ö†Ô∏è Avisa a los estudiantes antes de deshabilitar el per√≠odo manualmente.</p>
          <p>üîí Una vez vencida la fecha, el sistema bloquear√° autom√°ticamente las propuestas.</p>
          <p>üìÖ Mant√©n fechas claras y comun√≠calas en el calendario institucional.</p>
        </div>
      </div>
    </div>
  </div>
</div>
