<!-- Navbar del profesor -->
<nav class="profesor-navbar">
  <div class="navbar-brand">
    <i class="fas fa-calendar-check"></i>
    <span>AcTitUBB - Fechas Importantes de Proyectos</span>
  </div>
  
  <div class="navbar-actions">
    <button class="btn-secondary" (click)="volver()">
      <i class="fas fa-arrow-left"></i>
      Volver al Panel
    </button>
  </div>
</nav>

<!-- Contenido principal -->
<div class="main-container">
  <!-- Header -->
  <div class="page-header fade-in">
    <div class="header-content">
      <h1><i class="fas fa-calendar-check"></i> Gestión de Fechas Importantes</h1>
      <p>Administra fechas límite y eventos importantes para tus estudiantes tesistas</p>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="abrirFormulario()">
        <i class="fas fa-plus-circle"></i>
        Nueva Fecha Importante
      </button>
    </div>
  </div>

  <!-- Filtros y controles -->
  <div class="filtros-section slide-in-left">
    <div class="filtros-grid">
      <div class="filtro-grupo">
        <label for="filtroProyecto">Filtrar por Proyecto:</label>
        <select id="filtroProyecto" [(ngModel)]="proyectoSeleccionado" (change)="cargarFechasDeProyecto(proyectoSeleccionado)">
          <option value="">Todos los proyectos</option>
          <option *ngFor="let proyecto of proyectosAsignados" [value]="proyecto.id">
            {{proyecto.titulo}} - {{proyecto.estudiante_nombre}}
          </option>
        </select>
      </div>

      <div class="stats-resumen">
        <div class="stat-item">
          <i class="fas fa-project-diagram"></i>
          <span class="stat-number">{{proyectosAsignados.length}}</span>
          <span class="stat-label">Proyectos</span>
        </div>
        <div class="stat-item">
          <i class="fas fa-calendar-alt"></i>
          <span class="stat-number">{{fechasImportantes.length}}</span>
          <span class="stat-label">Fechas</span>
        </div>
        <div class="stat-item warning">
          <i class="fas fa-exclamation-triangle"></i>
          <span class="stat-number">{{fechasProximas}}</span>
          <span class="stat-label">Próximas</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="cargando" class="loading-state">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
    </div>
    <p>Cargando fechas importantes...</p>
  </div>

  <!-- Estado vacío - Sin proyectos -->
  <div *ngIf="!cargando && proyectosAsignados.length === 0" class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-user-graduate"></i>
    </div>
    <h3>No tienes proyectos asignados</h3>
    <p>No se encontraron proyectos de tesis bajo tu supervisión</p>
    <button class="btn-primary" (click)="volver()">
      <i class="fas fa-arrow-left"></i>
      Volver al Dashboard
    </button>
  </div>

  <!-- Estado vacío - Sin fechas importantes -->
  <div *ngIf="!cargando && proyectosAsignados.length > 0 && fechasImportantes.length === 0" class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-calendar-plus"></i>
    </div>
    <h3>No hay fechas importantes registradas</h3>
    <p>Comienza agregando fechas límite e hitos importantes para tus tesistas</p>
    <button class="btn-primary" (click)="abrirFormulario()">
      <i class="fas fa-plus-circle"></i>
      Crear Primera Fecha
    </button>
  </div>

  <!-- Lista de fechas importantes -->
  <div *ngIf="!cargando && fechasImportantes.length > 0" class="fechas-grid">
    <div *ngFor="let fecha of fechasImportantes" 
         class="fecha-card" 
         [ngClass]="[obtenerClasePrioridad(fecha.prioridad), obtenerClaseEstado(fecha)]">
      
      <div class="fecha-header">
        <div class="fecha-tipo">
          <i [class]="obtenerIconoTipo(fecha.tipo_fecha)"></i>
          {{fecha.tipo_fecha | titlecase}}
        </div>
        <div class="fecha-prioridad">
          {{fecha.prioridad | titlecase}}
        </div>
      </div>

      <div class="fecha-content">
        <h3>{{fecha.titulo}}</h3>
        <p class="fecha-descripcion" *ngIf="fecha.descripcion">{{fecha.descripcion}}</p>
        
        <div class="fecha-info">
          <div class="info-item">
            <i class="fas fa-project-diagram"></i>
            <span><strong>Proyecto:</strong> {{fecha.proyecto_titulo}}</span>
          </div>
          <div class="info-item">
            <i class="fas fa-user-graduate"></i>
            <span><strong>Estudiante:</strong> {{fecha.estudiante_nombre}}</span>
          </div>
          <div class="info-item">
            <i class="fas fa-calendar"></i>
            <span><strong>Fecha límite:</strong> {{formatearFecha(fecha.fecha_limite)}}</span>
          </div>
          <div class="info-item" *ngIf="!fecha.completada">
            <i class="fas fa-clock"></i>
            <span><strong>Días restantes:</strong> 
              <span [class]="diasHastaFecha(fecha.fecha_limite) <= 3 ? 'dias-criticos' : 'dias-normales'">
                {{diasHastaFecha(fecha.fecha_limite)}} días
              </span>
            </span>
          </div>
        </div>
      </div>

      <div class="fecha-actions">
        <button class="btn-small btn-secondary" (click)="editarFecha(fecha)">
          <i class="fas fa-edit"></i>
          Editar
        </button>
        
        <button class="btn-small" 
                [class]="fecha.completada ? 'btn-warning' : 'btn-success'"
                (click)="marcarCompletada(fecha)">
          <i [class]="fecha.completada ? 'fas fa-undo' : 'fas fa-check'"></i>
          {{fecha.completada ? 'Desmarcar' : 'Completar'}}
        </button>
        
        <button class="btn-small btn-danger" (click)="eliminarFecha(fecha)">
          <i class="fas fa-trash"></i>
          Eliminar
        </button>
      </div>
    </div>
  </div>

  <!-- Estado vacío de fechas -->
  <div *ngIf="!cargando && proyectosAsignados.length > 0 && fechasImportantes.length === 0" class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-calendar-plus"></i>
    </div>
    <h3>No hay fechas importantes</h3>
    <p>No se han creado fechas importantes para {{proyectoSeleccionado ? 'este proyecto' : 'tus proyectos'}}</p>
    <button class="btn-primary" (click)="abrirFormulario()">
      <i class="fas fa-plus"></i>
      Crear Primera Fecha
    </button>
  </div>
</div>

<!-- Modal para crear/editar fecha importante -->
<div *ngIf="mostrarFormulario" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h2>
        <i class="fas fa-calendar-plus"></i>
        {{fechaSeleccionada ? 'Editar' : 'Nueva'}} Fecha Importante
      </h2>
      <button class="btn-close" (click)="cancelarFormulario()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <form (ngSubmit)="fechaSeleccionada ? actualizarFecha() : crearFechaImportante()">
        <div class="form-row">
          <div class="form-group">
            <label for="titulo">Título *</label>
            <input 
              type="text" 
              id="titulo"
              [(ngModel)]="nuevaFecha.titulo"
              name="titulo"
              placeholder="Ej: Entrega de Avance Capítulo 1"
              required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="proyecto">Proyecto *</label>
            <select id="proyecto" [(ngModel)]="nuevaFecha.proyecto_id" name="proyecto_id" required>
              <option value="">Seleccionar proyecto</option>
              <option *ngFor="let proyecto of proyectosAsignados" [value]="proyecto.id">
                {{proyecto.titulo}} - {{proyecto.estudiante_nombre}}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="fecha_limite">Fecha Límite *</label>
            <input 
              type="date" 
              id="fecha_limite"
              [(ngModel)]="nuevaFecha.fecha_limite"
              name="fecha_limite"
              required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="tipo_fecha">Tipo de Fecha</label>
            <select id="tipo_fecha" [(ngModel)]="nuevaFecha.tipo_fecha" name="tipo_fecha">
              <option *ngFor="let tipo of tiposFecha" [value]="tipo.value">
                {{tipo.label}}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="prioridad">Prioridad</label>
            <select id="prioridad" [(ngModel)]="nuevaFecha.prioridad" name="prioridad">
              <option *ngFor="let prioridad of prioridades" [value]="prioridad.value">
                {{prioridad.label}}
              </option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group full-width">
            <label for="descripcion">Descripción</label>
            <textarea 
              id="descripcion" 
              [(ngModel)]="nuevaFecha.descripcion"
              name="descripcion"
              rows="3"
              placeholder="Describe los detalles de esta fecha importante...">
            </textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary">
            <i class="fas fa-save"></i>
            {{fechaSeleccionada ? 'Actualizar' : 'Crear'}} Fecha
          </button>
          <button type="button" class="btn-secondary" (click)="cancelarFormulario()">
            <i class="fas fa-times"></i>
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="main-footer">
  <div class="footer-content">
    <p>&copy; 2024 Universidad del Bío-Bío - Gestión de Fechas Importantes</p>
  </div>
</footer>