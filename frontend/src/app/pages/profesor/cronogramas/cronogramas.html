<!-- Navbar -->
<nav class="navbar">
  <div class="navbar-brand">
    <i class="fas fa-graduation-cap"></i>
    <span>AcTitUBB - Cronogramas</span>
  </div>
  
  <div class="navbar-actions">
    <button class="btn-secondary" (click)="volver()">
      <i class="fas fa-arrow-left"></i>
      Volver
    </button>
  </div>
</nav>

<!-- Contenido principal -->
<div class="main-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1><i class="fas fa-calendar-alt"></i> Gestión de Cronogramas</h1>
      <p>Administra cronogramas y hitos de entrega para tus proyectos asignados</p>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
    </div>
    <p>Cargando información...</p>
  </div>

  <!-- Error/Success Messages -->
  <div *ngIf="error" class="alert alert-error">
    <i class="fas fa-exclamation-triangle"></i>
    <span>{{ error }}</span>
    <button (click)="limpiarMensajes()" class="btn-close">×</button>
  </div>

  <div *ngIf="success" class="alert alert-success">
    <i class="fas fa-check-circle"></i>
    <span>{{ success }}</span>
    <button (click)="limpiarMensajes()" class="btn-close">×</button>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!loading" class="content-grid">
    <!-- Panel izquierdo - Lista de proyectos -->
    <div class="projects-panel">
      <div class="panel-header">
        <h2><i class="fas fa-project-diagram"></i> Proyectos Asignados</h2>
      </div>

      <div *ngIf="proyectosAsignados.length === 0" class="empty-state">
        <i class="fas fa-folder-open"></i>
        <p>No tienes proyectos asignados</p>
      </div>

      <div class="projects-list">
        <div 
          *ngFor="let proyecto of proyectosAsignados" 
          class="project-card"
          [class.selected]="proyectoSeleccionado?.id === proyecto.id"
          (click)="seleccionarProyecto(proyecto)"
        >
          <div class="project-info">
            <h3>{{ proyecto.titulo }}</h3>
            <p class="estudiante">
              <i class="fas fa-user-graduate"></i>
              {{ proyecto.estudiante_nombre }}
            </p>
            <span class="estado" [class]="'estado-' + proyecto.estado">
              {{ proyecto.estado }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Panel derecho - Cronograma y hitos -->
    <div class="chronogram-panel">
      <!-- Sin proyecto seleccionado -->
      <div *ngIf="!proyectoSeleccionado" class="no-selection">
        <i class="fas fa-calendar-plus"></i>
        <h3>Selecciona un proyecto</h3>
        <p>Elige un proyecto de la lista para gestionar su cronograma</p>
      </div>

      <!-- Proyecto seleccionado -->
      <div *ngIf="proyectoSeleccionado" class="project-details">
        <!-- Header del proyecto -->
        <div class="project-header">
          <div class="project-title">
            <h2>{{ proyectoSeleccionado.titulo }}</h2>
            <p>{{ proyectoSeleccionado.descripcion }}</p>
          </div>
          
          <div class="project-actions">
            <button class="btn-primary" (click)="abrirModalFecha()">
              <i class="fas fa-plus"></i>
              Agregar Fecha Importante
            </button>
          </div>
        </div>

        <!-- Fechas importantes del proyecto -->
        <div class="fechas-section">
          <h3>
            <i class="fas fa-calendar-alt"></i>
            Cronograma del Proyecto ({{ fechasImportantes.length }} fechas)
          </h3>
          
          <!-- Sin fechas -->
          <div *ngIf="fechasImportantes.length === 0" class="no-chronogram">
            <i class="fas fa-calendar-times"></i>
            <h4>Sin fechas programadas</h4>
            <p>Agrega fechas importantes para crear el cronograma del proyecto.</p>
          </div>

          <!-- Lista de fechas -->
          <div *ngIf="fechasImportantes.length > 0" class="fechas-list">
            <div *ngFor="let fecha of fechasImportantes" class="fecha-card" [class.pasada]="esFechaPasada(fecha.fecha || fecha.fecha_limite)">
              <div class="fecha-header-card">
                <div class="fecha-icon" [class]="'tipo-' + fecha.tipo_fecha">
                  <i [class]="getIconoTipoFecha(fecha.tipo_fecha)"></i>
                </div>
                <div class="fecha-tipo-badge">
                  <span class="tipo-badge">{{ getTipoFechaLabel(fecha.tipo_fecha) }}</span>
                </div>
              </div>
              
              <div class="fecha-content">
                <h4 class="fecha-titulo" [title]="fecha.titulo">{{ fecha.titulo }}</h4>
                <p class="fecha-descripcion" *ngIf="fecha.descripcion" [title]="fecha.descripcion">
                  {{ fecha.descripcion }}
                </p>
                
                <div class="fecha-info-grid">
                  <div class="info-item">
                    <i class="fas fa-calendar-alt"></i>
                    <div class="info-content">
                      <span class="info-label">Fecha límite</span>
                      <span class="info-value">{{ formatearFecha(fecha.fecha || fecha.fecha_limite) }}</span>
                    </div>
                  </div>
                  
                  <div class="info-item">
                    <i class="fas fa-hourglass-half"></i>
                    <div class="info-content">
                      <span class="info-label">Estado</span>
                      <span class="info-value" *ngIf="!esFechaPasada(fecha.fecha || fecha.fecha_limite)">
                        <span class="badge-success">{{ getDiasRestantes(fecha.fecha || fecha.fecha_limite) }} días restantes</span>
                      </span>
                      <span class="info-value" *ngIf="esFechaPasada(fecha.fecha || fecha.fecha_limite)">
                        <span class="badge-danger">Vencida</span>
                      </span>
                    </div>
                  </div>

                  <div class="info-item" *ngIf="fecha.creado_por_rut">
                    <i class="fas fa-user"></i>
                    <div class="info-content">
                      <span class="info-label">Creado por</span>
                      <span class="info-value">{{ fecha.creador_nombre || fecha.creado_por_rut }}</span>
                    </div>
                  </div>

                  <div class="info-item" *ngIf="fecha.fecha_creacion">
                    <i class="fas fa-clock"></i>
                    <div class="info-content">
                      <span class="info-label">Fecha creación</span>
                      <span class="info-value">{{ formatearFecha(fecha.fecha_creacion) }}</span>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="fecha-actions">
                <button class="btn-icon btn-edit" (click)="$event.stopPropagation()" title="Editar fecha">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn-icon btn-delete" (click)="eliminarFecha(fecha)" title="Eliminar fecha">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Crear Fecha Importante -->
<div *ngIf="mostrarModalFecha" class="modal-overlay" (click)="cerrarModalFecha()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-calendar-plus"></i> Crear Fecha Importante</h3>
      <button class="btn-close" (click)="cerrarModalFecha()">×</button>
    </div>

    <form (ngSubmit)="crearFechaImportante()" class="modal-form">
      <div class="form-group">
        <label for="tituloFecha">Título *</label>
        <input 
          type="text" 
          id="tituloFecha"
          [(ngModel)]="nuevaFecha.titulo"
          name="tituloFecha"
          required
          placeholder="Ej: Entrega del primer avance"
        >
      </div>

      <div class="form-group">
        <label for="tipoFecha">Tipo de fecha *</label>
        <select 
          id="tipoFecha"
          [(ngModel)]="nuevaFecha.tipo_fecha"
          name="tipoFecha"
          required
        >
          <option *ngFor="let tipo of tiposFecha" [value]="tipo.value">
            {{ tipo.label }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="fechaLimite">Fecha límite *</label>
        <input 
          type="date" 
          id="fechaLimite"
          [(ngModel)]="nuevaFecha.fecha_limite"
          name="fechaLimite"
          required
        >
      </div>

      <div class="form-group">
        <label for="descripcionFecha">Descripción</label>
        <textarea 
          id="descripcionFecha"
          [(ngModel)]="nuevaFecha.descripcion"
          name="descripcionFecha"
          rows="3"
          placeholder="Describe los detalles de esta fecha importante"
        ></textarea>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="cerrarModalFecha()">
          Cancelar
        </button>
        <button type="submit" class="btn-primary" [disabled]="loading">
          <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
          <i class="fas fa-save" *ngIf="!loading"></i>
          {{ loading ? 'Guardando...' : 'Crear Fecha' }}
        </button>
      </div>
    </form>
  </div>
</div>
