<!-- Contenedor principal -->
<div class="main-container">
  <!-- Header compacto con gradiente -->
  <div class="page-header-compact">
    <div class="header-left">
      <h1>
        <i class="fas fa-user-tie"></i>
        Gestionar Jefes de Carrera
      </h1>
      <p class="header-subtitle">Asignar y remover jefes de carrera para cada programa académico</p>
    </div>
    <button class="btn-volver" (click)="volverAtras()" title="Volver a la página anterior">
      <i class="fas fa-arrow-left"></i>
      Volver
    </button>
  </div>

  <!-- Mensaje de estado -->
  @if (mensaje()) {
    <div class="alert" [class.alert-success]="mensaje()!.tipo === 'success'" [class.alert-error]="mensaje()!.tipo === 'error'">
      <i class="fas" [class.fa-check-circle]="mensaje()!.tipo === 'success'" [class.fa-exclamation-circle]="mensaje()!.tipo === 'error'"></i>
      {{ mensaje()!.texto }}
    </div>
  }

  <!-- Loader -->
  @if (loading()) {
    <div class="loader-container">
      <div class="spinner"></div>
      <p>Cargando carreras...</p>
    </div>
  }

  <!-- Error -->
  @if (error()) {
    <div class="error-container">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error() }}</p>
      <button class="btn-primary" (click)="cargarDatos()">
        <i class="fas fa-redo"></i>
        Reintentar
      </button>
    </div>
  }

  <!-- Lista de carreras -->
  @if (!loading() && !error()) {
    <div class="carreras-grid">
      @for (carrera of carreras(); track carrera.id) {
        <div class="carrera-card">
          <div class="carrera-header">
            <div class="carrera-info">
              <h3>{{ carrera.nombre }}</h3>
              <span class="codigo-badge">{{ carrera.codigo }}</span>
              <p class="facultad-nombre">
                <i class="fas fa-building"></i>
                {{ carrera.facultad_nombre }}
              </p>
            </div>
          </div>

          <div class="jefe-info">
            @if (carrera.jefe_carrera_rut) {
              <div class="jefe-actual">
                <div class="jefe-avatar">
                  {{ obtenerIniciales(carrera.jefe_carrera_nombre!) }}
                </div>
                <div class="jefe-datos">
                  <p class="jefe-nombre">{{ carrera.jefe_carrera_nombre }}</p>
                  <p class="jefe-email">
                    <i class="fas fa-envelope"></i>
                    {{ carrera.jefe_carrera_email }}
                  </p>
                  <p class="jefe-rut">
                    <i class="fas fa-id-card"></i>
                    {{ carrera.jefe_carrera_rut }}
                  </p>
                </div>
              </div>
            } @else {
              <div class="sin-jefe">
                <i class="fas fa-user-slash"></i>
                <p>Sin jefe de carrera asignado</p>
              </div>
            }
          </div>

          <div class="carrera-actions">
            <button 
              class="btn-primary" 
              (click)="abrirModal(carrera)"
              [title]="carrera.jefe_carrera_rut ? 'Cambiar jefe de carrera' : 'Asignar jefe de carrera'">
              <i class="fas" [class.fa-user-plus]="!carrera.jefe_carrera_rut" [class.fa-user-edit]="carrera.jefe_carrera_rut"></i>
              {{ carrera.jefe_carrera_rut ? 'Cambiar' : 'Asignar' }} Jefe
            </button>
            
            @if (carrera.jefe_carrera_rut) {
              <button 
                class="btn-danger" 
                (click)="removerJefe(carrera)"
                title="Remover jefe de carrera">
                <i class="fas fa-user-minus"></i>
                Remover
              </button>
            }
          </div>
        </div>
      }
    </div>

    @if (carreras().length === 0) {
      <div class="empty-state">
        <i class="fas fa-graduation-cap"></i>
        <p>No hay carreras registradas</p>
      </div>
    }
  }

  <!-- Cierre del contenedor principal -->
</div>

<!-- Modal de asignación -->
@if (mostrarModal()) {
  <div class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>
            <i class="fas fa-user-tie"></i>
            Asignar Jefe de Carrera
          </h2>
          <button class="btn-close" (click)="cerrarModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="modal-body">
          <div class="carrera-selected">
            <p><strong>Carrera:</strong> {{ carreraSeleccionada()?.nombre }}</p>
            <p><strong>Código:</strong> {{ carreraSeleccionada()?.codigo }}</p>
            @if (carreraSeleccionada()?.jefe_carrera_rut) {
              <p class="jefe-actual-info">
                <strong>Jefe actual:</strong> {{ carreraSeleccionada()?.jefe_carrera_nombre }}
              </p>
            }
          </div>

          <div class="form-group">
            <label for="profesor">Seleccionar Profesor:</label>
            <select 
              id="profesor" 
              [(ngModel)]="profesorSeleccionado" 
              class="form-control">
              <option value="">-- Seleccione un profesor --</option>
              @for (profesor of profesores(); track profesor.rut) {
                <option [value]="profesor.rut">
                  {{ profesor.nombre }} ({{ profesor.rut }})
                </option>
              }
            </select>
            <small class="form-hint">
              El profesor seleccionado será asignado como Jefe de Carrera y su rol cambiará a Administrador
            </small>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn-secondary" (click)="cerrarModal()">
            <i class="fas fa-times"></i>
            Cancelar
          </button>
          <button 
            class="btn-primary" 
            (click)="asignarJefe()"
            [disabled]="!profesorSeleccionado()">
            <i class="fas fa-check"></i>
            Asignar Jefe
          </button>
        </div>
      </div>
    </div>
  }
