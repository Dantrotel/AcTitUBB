<!-- Navbar con acciones rápidas -->
<nav class="navbar">
  <div class="navbar-brand">
    <i class="fas fa-graduation-cap"></i>
    <span>AcTitUBB</span>
  </div>
  
  <div class="navbar-actions">
    <div class="action-item" (click)="navegar('propuestas/crear')" >
      <i class="fas fa-plus-circle"></i>
      <span>Crear Propuesta</span>
    </div>
    
    <div class="action-item" (click)="navegar('propuestas/listar-propuesta')" >
      <i class="fas fa-list-alt"></i>
      <span>Mis Propuestas</span>
    </div>

    <!-- Menú de Calendario Matching -->
    <div class="action-item calendario-menu" (click)="toggleCalendarioMenu()">
      <i class="fas fa-calendar-alt"></i>
      <span>Calendario</span>
      <i class="fas fa-chevron-down"></i>
      
      <div class="dropdown-menu" [class.show]="showCalendarioMenu">
        <div class="dropdown-item" (click)="navegar('estudiante/calendario/dashboard')">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </div>
        <div class="dropdown-item" (click)="navegar('estudiante/calendario/disponibilidades')">
          <i class="fas fa-clock"></i>
          <span>Mis Horarios</span>
        </div>
        <div class="dropdown-item" (click)="navegar('estudiante/calendario/solicitudes')">
          <i class="fas fa-handshake"></i>
          <span>Solicitar Reunión</span>
        </div>
        <div class="dropdown-item" (click)="navegar('estudiante/calendario/gestion')">
          <i class="fas fa-calendar-check"></i>
          <span>Mis Reuniones</span>
        </div>
      </div>
    </div>
    
    <div class="action-item user-menu" (click)="toggleUserMenu()" >
      <i class="fas fa-user-circle"></i>
      <span>{{estudiante.nombre || 'Estudiante'}}</span>
      <i class="fas fa-chevron-down"></i>
      
      <div class="dropdown-menu" [class.show]="showUserMenu">
        <div class="dropdown-item" (click)="navegar('perfil')">
          <i class="fas fa-user"></i>
          <span>Mi Perfil</span>
        </div>
        <div class="dropdown-item" (click)="cerrarSesion()">
          <i class="fas fa-sign-out-alt"></i>
          <span>Cerrar Sesión</span>
        </div>
      </div>
    </div>
  </div>
</nav>

<!-- Contenido principal -->
<div class="main-container">
  <!-- Mensaje de error -->
  <div class="error-banner" *ngIf="hasError">
    <div class="error-content">
      <i class="fas fa-exclamation-triangle"></i>
      <span>{{ errorMensaje }}</span>
      <div class="error-actions">
        <button class="btn-retry" (click)="recargarDatos()">
          <i class="fas fa-redo"></i>
          Reintentar
        </button>
        <button class="btn-close" (click)="ocultarError()">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="welcome-section">
    <div class="welcome-content">
      <h1>¡Bienvenido, {{estudiante.nombre || 'Estudiante'}}!</h1>
      <p class="status-text">
        <i class="fas fa-info-circle"></i>
        Estado actual: <span class="status-badge" [ngClass]="getEstadoClass()">{{ getEstadoTexto() }}</span>
      </p>
    </div>
    
    <div class="welcome-illustration">
      <i class="fas fa-rocket"></i>
    </div>
  </div>

  <!-- Indicador de carga -->
  <div class="loading-overlay" *ngIf="loadingPropuestas || loadingEstudiante">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>{{ loadingEstudiante ? 'Cargando perfil...' : 'Cargando propuestas...' }}</p>
    </div>
  </div>

  <!-- Dashboard Cards -->
  <div class="dashboard-grid" [class.loading]="loadingPropuestas || loadingEstudiante">
    <div class="dashboard-card primary-card" (click)="navegarAUltimaPropuesta()">
      <div class="card-icon">
        <i class="fas fa-clipboard-check"></i>
      </div>
      <div class="card-content">
        <h3>Última Revisión</h3>
        <p *ngIf="ultimaPropuesta">
          Enviada el {{ultimaPropuesta.fecha_envio | date:'dd MMM'}}, 
          {{getEstadoTextoCard()}}
        </p>
        <p *ngIf="!ultimaPropuesta">No hay propuestas enviadas</p>
        <button class="btn-primary">
          <i class="fas fa-eye"></i>
          {{ultimaPropuesta ? 'Ver detalles' : 'Crear primera propuesta'}}
        </button>
      </div>
    </div>
    
    <div class="dashboard-card secondary-card" (click)="navegar('propuestas/listar-propuesta')">
      <div class="card-icon">
        <i class="fas fa-chart-line"></i>
      </div>
      <div class="card-content">
        <h3>Progreso del Proyecto</h3>
        <p>{{obtenerFaseProyecto()}}</p>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progresoProyecto"></div>
        </div>
        <span class="progress-text">{{progresoProyecto}}% Completado</span>
      </div>
    </div>
    
    <div class="dashboard-card accent-card" (click)="abrirCalendario()">
      <div class="card-icon">
        <i class="fas fa-calendar-alt"></i>
      </div>
      <div class="card-content">
        <h3>Próximas Fechas</h3>
        <div class="date-item" *ngFor="let fecha of proximasFechas">
          <i [class]="fecha.icono"></i>
          <span>{{fecha.titulo}}: {{fecha.fecha | date:'dd MMM'}}</span>
        </div>
        <div class="date-item" *ngIf="proximasFechas.length === 0">
          <i class="fas fa-info-circle"></i>
          <span>No hay fechas programadas</span>
        </div>
        <button class="btn-secondary">
          <i class="fas fa-calendar"></i>
          Ver Calendario
        </button>
      </div>
    </div>
    
    <div class="dashboard-card action-card" (click)="navegar('propuestas/crear')">
      <div class="card-icon">
        <i class="fas fa-plus"></i>
      </div>
      <div class="card-content">
        <h3>Crear Nueva Propuesta</h3>
        <p>Inicia una nueva propuesta para tu proyecto de título</p>
        <button class="btn-secondary">
          <i class="fas fa-arrow-right"></i>
          Comenzar
        </button>
      </div>
    </div>
  </div>

  <!-- Información del profesor asignado -->
  <div class="profesor-info" *ngIf="ultimaPropuesta">
    <div class="profesor-card">
      <div class="card-header">
        <i class="fas fa-chalkboard-teacher"></i>
        <h3>Profesor Asignado</h3>
      </div>
      <div class="card-content">
        <div class="profesor-details" *ngIf="ultimaPropuesta.nombre_profesor">
          <div class="profesor-avatar">
            <i class="fas fa-user-tie"></i>
          </div>
          <div class="profesor-info-text">
            <h4>{{ ultimaPropuesta.nombre_profesor }}</h4>
            <p>{{ ultimaPropuesta.profesor_email || 'Email no disponible' }}</p>
            <span class="rut-badge">{{ ultimaPropuesta.profesor_rut }}</span>
          </div>
        </div>
        <div class="no-profesor" *ngIf="!ultimaPropuesta.nombre_profesor">
          <div class="no-profesor-icon">
            <i class="fas fa-user-clock"></i>
          </div>
          <div class="no-profesor-text">
            <h4>Sin profesor asignado</h4>
            <p>Tu propuesta está pendiente de asignación</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Sección de estadísticas rápidas -->
  <div class="stats-section">
    <h2>Resumen de Actividad</h2>
    <div class="stats-grid">
      <div class="stat-item" (click)="navegar('propuestas/listar-propuesta')">
        <div class="stat-number">{{estadisticas.totalPropuestas}}</div>
        <div class="stat-label">Propuestas Enviadas</div>
      </div>
      <div class="stat-item" (click)="navegar('propuestas/listar-propuesta')">
        <div class="stat-number">{{estadisticas.enRevision}}</div>
        <div class="stat-label">En Revisión</div>
      </div>
      <div class="stat-item" (click)="navegar('propuestas/listar-propuesta')">
        <div class="stat-number">{{estadisticas.aprobadas}}</div>
        <div class="stat-label">Aprobadas</div>
      </div>
      <div class="stat-item">
        <div class="stat-number">{{estadisticas.diasRestantes}}</div>
        <div class="stat-label">Días Restantes</div>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="main-footer">
  <div class="footer-content">
    <p>&copy; {{fechaActual() | date:'yyyy'}} Universidad del Bío-Bío - Sistema de Gestión de Proyectos de Título</p>
  </div>
</footer>

<!-- Modal del Calendario -->
<app-calendar-modal 
  *ngIf="showCalendarModal"
  [propuestas]="propuestas"
  (close)="cerrarCalendario()">
</app-calendar-modal>
