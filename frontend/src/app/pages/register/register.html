<div class="register-container">
  <!-- Header principal -->
  <div class="header">
    <div class="header-content">
      <h1><i class="fas fa-user-plus"></i> Crear Cuenta</h1>
      <p>Regístrate en la plataforma AcTitUBB para comenzar tu proceso de titulación</p>
    </div>
    <div class="header-actions">
      <button class="btn-volver-header" (click)="volver()">
        <i class="fas fa-arrow-left"></i>
        Volver
      </button>
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="form-section">
    <div class="section-header">
      <h3><i class="fas fa-user-plus"></i> Registro de Usuario</h3>
    </div>

    <form (ngSubmit)="register()" novalidate class="register-form">
      <div class="form-row">
        <div class="form-group">
          <label for="rut">
            <i class="fas fa-id-card"></i> RUT
          </label>
          <input
            type="text"
            id="rut"
            [(ngModel)]="rut"
            name="rut"
            class="form-control"
            required
            placeholder="12345678-9"
            autocomplete="off"
          />
        </div>

        <div class="form-group">
          <label for="nombre">
            <i class="fas fa-user"></i> Nombre completo
          </label>
          <input
            type="text"
            id="nombre"
            [(ngModel)]="nombre"
            name="nombre"
            class="form-control"
            required
            placeholder="Ej: Juan Edgardo"
            autocomplete="off"
          />
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email">
            <i class="fas fa-envelope"></i> Correo institucional
          </label>
          <input
            type="email"
            id="email"
            [ngModel]="email()"
            (ngModelChange)="email.set($event); onEmailChange()"
            name="email"
            class="form-control"
            required
            placeholder="correo@alumnos.ubiobio.cl o correo@ubiobio.cl"
            autocomplete="off"
          />
          @if (isEstudiante()) {
            <small class="form-help">
              <i class="fas fa-info-circle"></i> 
              Correo de estudiante detectado. Selecciona tu carrera.
            </small>
          }
          @if (isProfesor()) {
            <small class="form-help">
              <i class="fas fa-info-circle"></i> 
              Correo de profesor detectado. Selecciona tu departamento.
            </small>
          }
        </div>

        <div class="form-group">
          <label for="password">
            <i class="fas fa-lock"></i> Contraseña
          </label>
          <input
            type="password"
            id="password"
            [(ngModel)]="password"
            name="password"
            class="form-control"
            required
            placeholder="********"
            autocomplete="new-password"
          />
        </div>
      </div>

      @if (isEstudiante()) {
        <div class="form-row">
          <div class="form-group">
            <label for="carrera">
              <i class="fas fa-graduation-cap"></i> Carrera <span class="required">*</span>
            </label>
            @if (cargandoCarreras()) {
              <div class="loading-message">
                <i class="fas fa-spinner fa-spin"></i> Cargando carreras...
              </div>
            } @else {
              <select
                id="carrera"
                [(ngModel)]="carreraId"
                name="carrera"
                class="form-control"
                required
              >
                <option [value]="0">Seleccione su carrera</option>
                @for (carrera of carreras(); track carrera.id) {
                  <option [value]="carrera.id">{{ carrera.nombre }}</option>
                }
              </select>
            }
            <small class="form-help">
              <i class="fas fa-info-circle"></i> 
              Como estudiante, debes seleccionar tu carrera para completar el registro.
            </small>
          </div>
        </div>
      }

      @if (isProfesor()) {
        <div class="form-row">
          <div class="form-group">
            <label for="departamento">
              <i class="fas fa-building"></i> Departamento <span class="required">*</span>
            </label>
            @if (cargandoDepartamentos()) {
              <div class="loading-message">
                <i class="fas fa-spinner fa-spin"></i> Cargando departamentos...
              </div>
            } @else {
              <select
                id="departamento"
                [(ngModel)]="departamentoId"
                name="departamento"
                class="form-control"
                required
              >
                <option [value]="0">Seleccione su departamento</option>
                @for (departamento of departamentos(); track departamento.id) {
                  <option [value]="departamento.id">{{ departamento.nombre }}</option>
                }
              </select>
            }
            <small class="form-help">
              <i class="fas fa-info-circle"></i> 
              Como profesor, debes seleccionar tu departamento para completar el registro.
            </small>
          </div>
        </div>
      }

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn-primary" 
          [disabled]="!rut || !nombre || !email || !password || (isEstudiante() && (!carreraId || carreraId === 0)) || (isProfesor() && (!departamentoId || departamentoId === 0))"
        >
          <i class="fas fa-user-plus"></i> Registrarse
        </button>
      </div>
    </form>
  </div>

  <!-- Messages -->
  <div class="messages" *ngIf="mensaje">
    <div class="alert" [ngClass]="{'alert-success': !mensaje.includes('Error'), 'alert-error': mensaje.includes('Error')}">
      <i class="fas" [ngClass]="{'fa-check-circle': !mensaje.includes('Error'), 'fa-exclamation-triangle': mensaje.includes('Error')}"></i>
      {{ mensaje }}
    </div>
  </div>

  <!-- Footer -->
  <footer class="main-footer">
    <div class="footer-content">
      <p>&copy; {{currentYear}} Universidad del Bío-Bío - Sistema de Gestión de Titulación</p>
    </div>
  </footer>
</div>