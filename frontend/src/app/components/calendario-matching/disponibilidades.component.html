<div class="disponibilidades-container">
  <!-- Header principal -->
  <div class="header">
    <div class="header-content">
      <h1><i class="fas fa-calendar-alt"></i> Gestión de Disponibilidades</h1>
      <p>Define tus horarios disponibles para reuniones automáticas</p>
    </div>
    <div class="header-actions">
      <button class="btn-volver-header" (click)="volver()">
        <i class="fas fa-arrow-left"></i>
        Volver
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <h3>Cargando disponibilidades...</h3>
    <p>Obteniendo información de horarios disponibles</p>
  </div>

  <!-- Messages -->
  <div class="messages" *ngIf="(errorMessage || successMessage) && !isLoading">
    <div class="alert alert-error" *ngIf="errorMessage">
      <i class="fas fa-exclamation-triangle"></i>
      {{ errorMessage }}
    </div>
    <div class="alert alert-success" *ngIf="successMessage">
      <i class="fas fa-check-circle"></i>
      {{ successMessage }}
    </div>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!isLoading">
    <!-- Formulario -->
    <div class="form-section">
      <div class="section-header">
        <h3>
          <i class="fas fa-plus"></i>
          {{ editandoId ? 'Editar Disponibilidad' : 'Agregar Nueva Disponibilidad' }}
        </h3>
      </div>
    
    <form class="disponibilidad-form" (ngSubmit)="editandoId ? guardarEdicion() : agregarDisponibilidad()">
      <div class="form-row">
        <div class="form-group">
          <label for="dia_semana">Día de la Semana</label>
          <select 
            id="dia_semana" 
            [(ngModel)]="nuevaDisponibilidad.dia_semana" 
            name="dia_semana"
            class="form-control"
            required>
            <option value="">Seleccionar día</option>
            <option *ngFor="let dia of diasSemana" [value]="dia.value">
              {{ dia.label }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="hora_inicio">Hora de Inicio</label>
          <select 
            id="hora_inicio" 
            [(ngModel)]="nuevaDisponibilidad.hora_inicio" 
            name="hora_inicio"
            class="form-control"
            required>
            <option value="">Seleccionar hora</option>
            <option *ngFor="let hora of horasDisponibles" [value]="hora">
              {{ hora }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="hora_fin">Hora de Fin</label>
          <select 
            id="hora_fin" 
            [(ngModel)]="nuevaDisponibilidad.hora_fin" 
            name="hora_fin"
            class="form-control"
            required>
            <option value="">Seleccionar hora</option>
            <option *ngFor="let hora of horasDisponibles" [value]="hora">
              {{ hora }}
            </option>
          </select>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              [(ngModel)]="nuevaDisponibilidad.activa" 
              name="activa">
            <span class="checkmark"></span>
            Activa
          </label>
        </div>
      </div>

      <div class="form-actions">
        <button 
          type="submit" 
          class="btn btn-primary"
          [disabled]="isLoading">
          <i class="fas fa-save"></i>
          {{ editandoId ? 'Guardar Cambios' : 'Agregar Disponibilidad' }}
        </button>

        <button 
          type="button" 
          class="btn btn-secondary"
          *ngIf="editandoId"
          (click)="cancelarEdicion()">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <!-- Lista de Disponibilidades -->
  <div class="disponibilidades-list">
    <h3><i class="fas fa-list"></i> Mis Disponibilidades</h3>
    
    <div class="loading" *ngIf="isLoading">
      <i class="fas fa-spinner fa-spin"></i> Cargando...
    </div>

    <div class="empty-state" *ngIf="!isLoading && disponibilidades.length === 0">
      <i class="fas fa-calendar-times"></i>
      <h4>No tienes disponibilidades configuradas</h4>
      <p>Agrega tu primera disponibilidad para que otros puedan solicitar reuniones contigo</p>
    </div>

    <div class="disponibilidades-grid" *ngIf="!isLoading && disponibilidades.length > 0">
      <div 
        class="disponibilidad-card" 
        *ngFor="let disponibilidad of disponibilidades"
        [class.inactive]="!disponibilidad.activa">
        
        <div class="card-header">
          <h4>{{ getDiaLabel(disponibilidad.dia_semana) }}</h4>
          <div class="status-badge" [class.active]="disponibilidad.activa">
            {{ disponibilidad.activa ? 'Activa' : 'Inactiva' }}
          </div>
        </div>

        <div class="card-content">
          <div class="time-range">
            <i class="fas fa-clock"></i>
            <span>{{ disponibilidad.hora_inicio }} - {{ disponibilidad.hora_fin }}</span>
          </div>
          
          <div class="duration">
            <i class="fas fa-hourglass-half"></i>
            <span>{{ calcularDuracion(disponibilidad.hora_inicio, disponibilidad.hora_fin) }}</span>
          </div>
        </div>

        <div class="card-actions">
          <button 
            class="btn btn-sm btn-outline"
            (click)="editarDisponibilidad(disponibilidad)"
            title="Editar">
            <i class="fas fa-edit"></i>
          </button>

          <button 
            class="btn btn-sm"
            [class.btn-success]="!disponibilidad.activa"
            [class.btn-warning]="disponibilidad.activa"
            (click)="toggleActiva(disponibilidad)"
            [title]="disponibilidad.activa ? 'Desactivar' : 'Activar'">
            <i class="fas" [class.fa-play]="!disponibilidad.activa" [class.fa-pause]="disponibilidad.activa"></i>
          </button>

          <button 
            class="btn btn-sm btn-danger"
            (click)="eliminarDisponibilidad(disponibilidad.id!)"
            title="Eliminar">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Información útil -->
  <div class="info-section">
    <div class="info-card">
      <h4><i class="fas fa-info-circle"></i> Información Importante</h4>
      <ul>
        <li>Las disponibilidades se usan para el matching automático de reuniones</li>
        <li>Puedes desactivar temporalmente una disponibilidad sin eliminarla</li>
        <li>Los horarios no pueden traslaparse en el mismo día</li>
        <li>Las reuniones se programan en bloques de 30 minutos o 1 hora</li>
      </ul>
    </div>
  </div>
</div>