<div class="dashboard-container">
  <!-- Header principal -->
  <div class="header">
    <div class="header-content">
      <h1><i class="fas fa-tachometer-alt"></i> Dashboard de Reuniones</h1>
      <p>Vista general de tus reuniones y solicitudes del sistema de matching</p>
    </div>
    <div class="header-actions">
      <button class="btn-volver-header" (click)="volver()">
        <i class="fas fa-arrow-left"></i>
        Volver
      </button>
      <button class="btn-actualizar" (click)="cargarDashboard()" [disabled]="isLoading">
        <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
        Actualizar
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <h3>Cargando dashboard...</h3>
    <p>Obteniendo información de reuniones y estadísticas</p>
  </div>

  <!-- Messages -->
  <div class="messages" *ngIf="(errorMessage || successMessage) && !isLoading">
    <div class="alert alert-error" *ngIf="errorMessage">
      <i class="fas fa-exclamation-triangle"></i>
      {{ errorMessage }}
    </div>
    <div class="alert alert-success" *ngIf="successMessage">
      <i class="fas fa-check-circle"></i>
      {{ successMessage }}
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="!isLoading">
    
    <!-- Estadísticas -->
    <div class="estadisticas-section">
      <div class="section-header">
        <h3><i class="fas fa-chart-bar"></i> Estadísticas de Reuniones</h3>
      </div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="stat-content">
            <h4>{{ dashboardData.estadisticas.total_reuniones }}</h4>
            <p>Total Reuniones</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon success">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h4>{{ dashboardData.estadisticas.reuniones_completadas }}</h4>
            <p>Completadas</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon warning">
            <i class="fas fa-times-circle"></i>
          </div>
          <div class="stat-content">
            <h4>{{ dashboardData.estadisticas.reuniones_canceladas }}</h4>
            <p>Canceladas</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon info">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-content">
            <h4>{{ dashboardData.estadisticas.disponibilidades_activas }}</h4>
            <p>Disponibilidades</p>
          </div>
        </div>
      </div>

      <!-- Progreso -->
      <div class="progreso-card">
        <div class="progreso-header">
          <h4>Progreso de Reuniones</h4>
          <span class="progreso-porcentaje">{{ getProgreso() }}%</span>
        </div>
        <div class="progreso-bar">
          <div class="progreso-fill" [style.width.%]="getProgreso()"></div>
        </div>
        <p class="progreso-descripcion">
          {{ dashboardData.estadisticas.reuniones_completadas }} de {{ dashboardData.estadisticas.total_reuniones }} reuniones completadas
        </p>
      </div>
    </div>

    <!-- Reuniones de Hoy -->
    <div class="reuniones-hoy-section" *ngIf="dashboardData.reuniones_hoy.length > 0">
      <h3><i class="fas fa-calendar-day"></i> Reuniones de Hoy</h3>
      <div class="reuniones-grid urgente">
        <div class="reunion-card hoy" *ngFor="let reunion of dashboardData.reuniones_hoy">
          <div class="card-header">
            <div class="reunion-info">
              <h4 *ngIf="userRole === 'estudiante'">{{ reunion.profesor_nombre }}</h4>
              <h4 *ngIf="userRole === 'profesor'">{{ reunion.estudiante_nombre }}</h4>
              <span class="tiempo-restante">{{ getTiempoRestante(reunion.fecha, reunion.hora_inicio) }}</span>
            </div>
            <div class="estado-badge" [class]="getEstadoClass(reunion.estado)">
              {{ getEstadoLabel(reunion.estado) }}
            </div>
          </div>

          <div class="card-content">
            <div class="horario">
              <i class="fas fa-clock"></i>
              <span>{{ formatearHora(reunion.hora_inicio) }} - {{ formatearHora(reunion.hora_fin) }}</span>
            </div>
            <div class="motivo">
              <i class="fas fa-comment"></i>
              <span>{{ reunion.motivo }}</span>
            </div>
          </div>

          <div class="card-actions" *ngIf="necesitaConfirmacion(reunion)">
            <button 
              class="btn btn-sm btn-success"
              (click)="confirmarReunion(reunion.id)">
              <i class="fas fa-check"></i>
              Confirmar
            </button>
            <button 
              class="btn btn-sm btn-danger"
              (click)="cancelarReunion(reunion.id)">
              <i class="fas fa-times"></i>
              Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Reuniones Próximas -->
    <div class="reuniones-proximas-section" *ngIf="dashboardData.reuniones_proximas.length > 0">
      <h3><i class="fas fa-calendar-alt"></i> Próximas Reuniones</h3>
      <div class="reuniones-grid">
        <div class="reunion-card" *ngFor="let reunion of dashboardData.reuniones_proximas">
          <div class="card-header">
            <div class="reunion-info">
              <h4 *ngIf="userRole === 'estudiante'">{{ reunion.profesor_nombre }}</h4>
              <h4 *ngIf="userRole === 'profesor'">{{ reunion.estudiante_nombre }}</h4>
              <span class="fecha">{{ formatearFecha(reunion.fecha) }}</span>
            </div>
            <div class="estado-badge" [class]="getEstadoClass(reunion.estado)">
              {{ getEstadoLabel(reunion.estado) }}
            </div>
          </div>

          <div class="card-content">
            <div class="horario">
              <i class="fas fa-clock"></i>
              <span>{{ formatearHora(reunion.hora_inicio) }} - {{ formatearHora(reunion.hora_fin) }}</span>
            </div>
            <div class="motivo">
              <i class="fas fa-comment"></i>
              <span>{{ reunion.motivo }}</span>
            </div>
          </div>

          <div class="card-actions" *ngIf="necesitaConfirmacion(reunion)">
            <button 
              class="btn btn-sm btn-success"
              (click)="confirmarReunion(reunion.id)">
              <i class="fas fa-check"></i>
              Confirmar
            </button>
            <button 
              class="btn btn-sm btn-danger"
              (click)="cancelarReunion(reunion.id)">
              <i class="fas fa-times"></i>
              Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Solicitudes Pendientes (solo para profesores) -->
    <div class="solicitudes-section" *ngIf="userRole === 'profesor'">
      <div class="section-header">
        <h3><i class="fas fa-inbox"></i> Solicitudes de Reunión Pendientes</h3>
      </div>
      
      <div *ngIf="dashboardData.solicitudes_pendientes.length > 0" class="solicitudes-grid">
        <div class="solicitud-card" *ngFor="let solicitud of dashboardData.solicitudes_pendientes">
          <div class="card-header">
            <div class="solicitud-info">
              <h4>{{ solicitud.estudiante_nombre }}</h4>
              <span class="fecha-solicitud">{{ solicitud.fecha_solicitud | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="urgencia-badge" [class]="getUrgenciaClass(solicitud.urgencia)">
              {{ solicitud.urgencia }}
            </div>
          </div>

          <div class="card-content">
            <div class="motivo">
              <i class="fas fa-comment"></i>
              <span>{{ solicitud.motivo }}</span>
            </div>
          </div>

          <div class="card-actions" *ngIf="puedeResponderSolicitud(solicitud)">
            <button 
              class="btn btn-sm btn-success"
              (click)="responderSolicitud(solicitud.id, 'aceptada')">
              <i class="fas fa-check"></i>
              Aceptar
            </button>
            <button 
              class="btn btn-sm btn-danger"
              (click)="responderSolicitud(solicitud.id, 'rechazada')">
              <i class="fas fa-times"></i>
              Rechazar
            </button>
          </div>
        </div>
      </div>
      
      <div *ngIf="dashboardData.solicitudes_pendientes.length === 0" class="no-data-message">
        <div class="empty-state">
          <i class="fas fa-inbox-in"></i>
          <h4>No hay solicitudes pendientes</h4>
          <p>No tienes solicitudes de reunión pendientes por revisar en este momento.</p>
        </div>
      </div>
    </div>

    <!-- Reuniones por Confirmar -->
    <div class="confirmacion-section" *ngIf="dashboardData.reuniones_por_confirmar.length > 0">
      <h3><i class="fas fa-exclamation-circle"></i> Requieren Confirmación</h3>
      <div class="reuniones-grid">
        <div class="reunion-card pendiente" *ngFor="let reunion of dashboardData.reuniones_por_confirmar">
          <div class="card-header">
            <div class="reunion-info">
              <h4 *ngIf="userRole === 'estudiante'">{{ reunion.profesor_nombre }}</h4>
              <h4 *ngIf="userRole === 'profesor'">{{ reunion.estudiante_nombre }}</h4>
              <span class="fecha">{{ formatearFecha(reunion.fecha) }}</span>
            </div>
            <div class="confirmation-status">
              <span class="confirmacion" 
                    [class.confirmada]="reunion.confirmacion_estudiante"
                    title="Confirmación del estudiante">
                <i class="fas fa-user-graduate"></i>
                {{ reunion.confirmacion_estudiante ? '✓' : '?' }}
              </span>
              <span class="confirmacion" 
                    [class.confirmada]="reunion.confirmacion_profesor"
                    title="Confirmación del profesor">
                <i class="fas fa-chalkboard-teacher"></i>
                {{ reunion.confirmacion_profesor ? '✓' : '?' }}
              </span>
            </div>
          </div>

          <div class="card-content">
            <div class="horario">
              <i class="fas fa-clock"></i>
              <span>{{ formatearHora(reunion.hora_inicio) }} - {{ formatearHora(reunion.hora_fin) }}</span>
            </div>
            <div class="motivo">
              <i class="fas fa-comment"></i>
              <span>{{ reunion.motivo }}</span>
            </div>
          </div>

          <div class="card-actions" *ngIf="necesitaConfirmacion(reunion)">
            <button 
              class="btn btn-sm btn-success"
              (click)="confirmarReunion(reunion.id)">
              <i class="fas fa-check"></i>
              Confirmar mi participación
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado vacío -->
    <div class="empty-dashboard" *ngIf="dashboardData.reuniones_hoy.length === 0 && 
                                        dashboardData.reuniones_proximas.length === 0 && 
                                        dashboardData.solicitudes_pendientes.length === 0 && 
                                        dashboardData.reuniones_por_confirmar.length === 0">
      <i class="fas fa-calendar-check"></i>
      <h3>No hay actividad reciente</h3>
      <p>No tienes reuniones programadas ni solicitudes pendientes en este momento.</p>
    </div>

  </div>
</div>