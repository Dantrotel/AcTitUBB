<div class="colaboradores-container">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <div class="icon-wrapper">
        <i class="fas fa-handshake"></i>
      </div>
      <div class="header-text">
        <h2>Colaboradores Externos del Proyecto</h2>
        <p>Gestiona supervisores, mentores y asesores técnicos</p>
      </div>
    </div>
    <div class="header-right">
      <button class="btn-primary" (click)="toggleFormulario()" [disabled]="!proyectoId">
        <i [class]="mostrarFormulario() ? 'fas fa-times' : 'fas fa-user-plus'"></i>
        {{ mostrarFormulario() ? 'Cancelar' : 'Asignar Colaborador' }}
      </button>
    </div>
  </div>

  <!-- Formulario de Asignación -->
  @if (mostrarFormulario()) {
    <div class="form-card">
      <div class="form-header">
        <i class="fas fa-user-tie"></i>
        <h3>Asignar Colaborador Externo</h3>
      </div>
      <form (ngSubmit)="asignarColaborador()" class="colaborador-form">
        <div class="form-grid">
          <!-- Colaborador -->
          <div class="form-group full-width">
            <label for="colaborador">
              <i class="fas fa-user"></i>
              Colaborador <span class="required">*</span>
            </label>
            <select 
              id="colaborador"
              [(ngModel)]="nuevaAsignacion.colaborador_id" 
              name="colaborador_id" 
              required
              class="form-control">
              <option value="">Seleccione un colaborador</option>
              @for (colab of colaboradoresDisponibles(); track colab.id) {
                <option [value]="colab.id">
                  {{ colab.nombre_completo }} - {{ colab.entidad_nombre }}
                </option>
              }
            </select>
            <small class="form-hint">
              <i class="fas fa-info-circle"></i>
              Solo colaboradores verificados y activos
            </small>
          </div>

          <!-- Rol en Proyecto -->
          <div class="form-group">
            <label for="rol">
              <i class="fas fa-briefcase"></i>
              Rol en el Proyecto <span class="required">*</span>
            </label>
            <select 
              id="rol"
              [(ngModel)]="nuevaAsignacion.rol_en_proyecto" 
              name="rol_en_proyecto" 
              required
              class="form-control">
              <option value="">Seleccione un rol</option>
              @for (rol of rolesDisponibles; track rol) {
                <option [value]="rol">{{ rol }}</option>
              }
            </select>
          </div>

          <!-- Fecha de Inicio -->
          <div class="form-group">
            <label for="fecha_inicio">
              <i class="fas fa-calendar-alt"></i>
              Fecha de Inicio
            </label>
            <input 
              type="date" 
              id="fecha_inicio"
              [(ngModel)]="nuevaAsignacion.fecha_inicio" 
              name="fecha_inicio"
              class="form-control">
          </div>

          <!-- Horas Dedicadas -->
          <div class="form-group">
            <label for="horas">
              <i class="fas fa-clock"></i>
              Horas Dedicadas (semanal)
            </label>
            <input 
              type="number" 
              id="horas"
              [(ngModel)]="nuevaAsignacion.horas_dedicadas" 
              name="horas_dedicadas" 
              min="1"
              placeholder="4"
              class="form-control">
            <small class="form-hint">Horas por semana</small>
          </div>

          <!-- Frecuencia de Interacción -->
          <div class="form-group">
            <label for="frecuencia">
              <i class="fas fa-sync-alt"></i>
              Frecuencia de Interacción
            </label>
            <select 
              id="frecuencia"
              [(ngModel)]="nuevaAsignacion.frecuencia_interaccion" 
              name="frecuencia_interaccion"
              class="form-control">
              <option value="">Seleccione frecuencia</option>
              @for (frec of frecuencias; track frec.value) {
                <option [value]="frec.value">{{ frec.label }}</option>
              }
            </select>
          </div>

          <!-- Descripción del Rol -->
          <div class="form-group full-width">
            <label for="descripcion">
              <i class="fas fa-align-left"></i>
              Descripción del Rol
            </label>
            <textarea 
              id="descripcion"
              [(ngModel)]="nuevaAsignacion.descripcion_rol" 
              name="descripcion_rol" 
              rows="3"
              placeholder="Ej: Supervisar avances semanales, aprobar entregables, evaluar desempeño"
              class="form-control"></textarea>
          </div>

          <!-- Puede Evaluar -->
          <div class="form-group full-width checkbox-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="nuevaAsignacion.puede_evaluar" 
                name="puede_evaluar">
              <span class="checkbox-custom"></span>
              <span class="checkbox-text">
                <i class="fas fa-star"></i>
                Este colaborador puede evaluar al estudiante
              </span>
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" (click)="toggleFormulario()">
            <i class="fas fa-times"></i>
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="cargando()">
            <i class="fas fa-save"></i>
            Asignar al Proyecto
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Loading State -->
  @if (cargando()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando colaboradores...</p>
    </div>
  }

  <!-- Empty State -->
  @else if (colaboradores().length === 0 && !mostrarFormulario()) {
    <div class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-users-slash"></i>
      </div>
      <h3>No hay colaboradores externos asignados</h3>
      <p>Los colaboradores externos aportan experiencia práctica y supervisión profesional al proyecto</p>
      <button class="btn-primary-large" (click)="toggleFormulario()">
        <i class="fas fa-user-plus"></i>
        Asignar Primer Colaborador
      </button>
    </div>
  }

  <!-- Lista de Colaboradores -->
  @else if (colaboradores().length > 0) {
    <div class="colaboradores-grid">
      @for (colab of colaboradores(); track colab.id) {
        <div class="colaborador-card" [class.inactivo]="!colab.activo">
          <!-- Card Header -->
          <div class="card-header">
            <div class="colaborador-avatar">
              <i class="fas fa-user-tie"></i>
            </div>
            <div class="colaborador-info">
              <h4>{{ colab.nombre_completo }}</h4>
              @if (colab.cargo) {
                <p class="cargo">{{ colab.cargo }}</p>
              }
              @if (colab.email) {
                <p class="email">
                  <i class="fas fa-envelope"></i>
                  {{ colab.email }}
                </p>
              }
            </div>
            <div class="card-status">
              <span class="status-badge" [class.activo]="colab.activo" [class.inactivo]="!colab.activo">
                <i [class]="colab.activo ? 'fas fa-check-circle' : 'fas fa-times-circle'"></i>
                {{ colab.activo ? 'Activo' : 'Inactivo' }}
              </span>
            </div>
          </div>

          <!-- Card Body -->
          <div class="card-body">
            <!-- Entidad -->
            <div class="info-row">
              <div class="info-label">
                <i class="fas fa-building"></i>
                Empresa
              </div>
              <div class="info-value">{{ colab.entidad_nombre || 'No especificada' }}</div>
            </div>

            <!-- Rol -->
            <div class="info-row">
              <div class="info-label">
                <i class="fas fa-briefcase"></i>
                Rol en Proyecto
              </div>
              <div class="info-value">
                <span class="rol-badge">{{ colab.rol_en_proyecto }}</span>
              </div>
            </div>

            <!-- Descripción del Rol -->
            @if (colab.descripcion_rol) {
              <div class="info-row full-width">
                <div class="info-label">
                  <i class="fas fa-align-left"></i>
                  Descripción
                </div>
                <div class="info-value descripcion">{{ colab.descripcion_rol }}</div>
              </div>
            }

            <!-- Fecha Inicio -->
            @if (colab.fecha_inicio) {
              <div class="info-row">
                <div class="info-label">
                  <i class="fas fa-calendar-alt"></i>
                  Fecha Inicio
                </div>
                <div class="info-value">{{ formatearFecha(colab.fecha_inicio) }}</div>
              </div>
            }

            <!-- Horas y Frecuencia -->
            <div class="info-row-group">
              @if (colab.horas_dedicadas) {
                <div class="info-row">
                  <div class="info-label">
                    <i class="fas fa-clock"></i>
                    Horas/Semana
                  </div>
                  <div class="info-value">{{ colab.horas_dedicadas }}h</div>
                </div>
              }
              @if (colab.frecuencia_interaccion) {
                <div class="info-row">
                  <div class="info-label">
                    <i class="fas fa-sync-alt"></i>
                    Frecuencia
                  </div>
                  <div class="info-value">{{ colab.frecuencia_interaccion }}</div>
                </div>
              }
            </div>

            <!-- Evaluación -->
            <div class="info-row">
              <div class="info-label">
                <i class="fas fa-star"></i>
                Evaluación
              </div>
              <div class="info-value">
                @if (colab.puede_evaluar) {
                  @if (colab.evaluacion_realizada) {
                    <span class="eval-badge evaluado">
                      <i class="fas fa-check-circle"></i>
                      Evaluado
                    </span>
                  } @else {
                    <span class="eval-badge pendiente">
                      <i class="fas fa-hourglass-half"></i>
                      Pendiente
                    </span>
                  }
                } @else {
                  <span class="eval-badge no-evalua">
                    <i class="fas fa-minus-circle"></i>
                    No evalúa
                  </span>
                }
              </div>
            </div>
          </div>

          <!-- Card Footer -->
          <div class="card-footer">
            <button class="btn-icon" title="Contactar">
              <i class="fas fa-envelope"></i>
              Contactar
            </button>
            <button class="btn-icon" title="Ver detalles">
              <i class="fas fa-eye"></i>
              Detalles
            </button>
            @if (colab.activo) {
              <button class="btn-icon danger" (click)="desasignarColaborador(colab)" title="Desasignar">
                <i class="fas fa-user-times"></i>
                Desasignar
              </button>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
